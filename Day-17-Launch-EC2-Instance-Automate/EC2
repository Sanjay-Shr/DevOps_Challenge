#!/bin/bash

# Basic EC2 creation script with simple error handling

# --- Configuration ---
AMI_ID="ami-0c02fb55956c7d316"   # Amazon Linux 2
INSTANCE_TYPE="t2.micro"
KEY_NAME="my-key"
SECURITY_GROUP="sg-0123456789abcdef0"
SUBNET_ID="subnet-0123456789abcdef0"

# --- Log file ---
LOG_FILE="ec2_creation.log"

echo "Starting EC2 creation..." | tee -a $LOG_FILE

# Step 1: Launch the EC2 instance
aws ec2 run-instances \
  --image-id $AMI_ID \
  --count 1 \
  --instance-type $INSTANCE_TYPE \
  --key-name $KEY_NAME \
  --security-group-ids $SECURITY_GROUP \
  --subnet-id $SUBNET_ID \
  --tag-specifications "ResourceType=instance,Tags=[{Key=Name,Value=DevOps-Instance}]" &>> $LOG_FILE

# Step 2: Basic error handling
if [ $? -eq 0 ]; then
  echo "EC2 instance launched successfully." | tee -a $LOG_FILE
else
  echo "Error: Failed to launch EC2 instance. Check the log file for details." | tee -a $LOG_FILE
  exit 1
fi

echo "EC2 creation script finished." | tee -a $LOG_FILE

